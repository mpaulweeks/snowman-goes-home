(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{21:function(e,t,n){e.exports=n(34)},33:function(e,t,n){},34:function(e,t,n){"use strict";n.r(t);var i,r=n(0),o=n.n(r),s=n(16),a=n.n(s),l=n(1),c=n(2),u=n(9),h=n(8),v=n(10),d=n(4),f=n(5),p=n(7),y=n(6),m=n.n(y),w=n(11);!function(e){e[e.Up=1]="Up",e[e.Down=2]="Down",e[e.Left=3]="Left",e[e.Right=4]="Right"}(i||(i={}));var g,b=Object.keys(i).filter(function(e){return isNaN(Number(e))}).map(function(e){return i[e]}),k=function(){function e(t,n,i){Object(l.a)(this,e),this.point=void 0,this.points=void 0,this.moves=void 0,this.point=t,this.points=n,this.moves=i}return Object(c.a)(e,[{key:"addMove",value:function(e,t){this.points.push(this.point),this.moves.push(t),this.point=e}},{key:"getNextMoves",value:function(){var e=this;return b.map(function(t){return{move:t,history:e.clone()}})}},{key:"clone",value:function(){return new e(this.point,Object(p.a)(this.points),Object(p.a)(this.moves))}},{key:"printMoves",value:function(){return this.moves.map(function(e){return i[e]}).join(", ")}}]),e}();!function(e){e[e.Start=1]="Start",e[e.Win=2]="Win",e[e.Block=3]="Block"}(g||(g={}));var j=function(){function e(t,n,i,r,o){Object(l.a)(this,e),this.width=void 0,this.height=void 0,this.start=void 0,this.win=void 0,this.blocks=void 0,this.blocksByKey={},this.width=t,this.height=n,this.start=i,this.win=r,this.blocks=o,this.blocksByKey=this.blocks.reduce(function(e,t){return e[t.toString()]=g.Block,e},{})}return Object(c.a)(e,[{key:"isWinningPoint",value:function(e){return this.win.equals(e)}},{key:"isIllegalPoint",value:function(e){var t=this.blocksByKey,n=this.width,i=this.height;return!!t[e.toString()]||e.x<0||e.x>=n||e.y<0||e.y>=i}},{key:"applyMove",value:function(e,t){for(var n=e,r=[n];;){var o=n.clone();if(t===i.Left)o.x--;else if(t===i.Right)o.x++;else if(t===i.Up)o.y--;else{if(t!==i.Down)throw new Error("unexpected move: ".concat(t));o.y++}if(this.isIllegalPoint(o))break;if(r.push(o),n=o,this.isWinningPoint(n))break}return{point:n,traveled:r}}},{key:"solve",value:function(){for(var e=this,t={},n=[new k(this.start,[],[])];n.length;){var i=n.shift(),r=i.point.toString();if(!t[r]){if(t[r]=!0,this.isWinningPoint(i.point))return i;i.getNextMoves().forEach(function(t){var i=t.move,r=t.history,o=e.applyMove(r.point,i).point;r.addMove(o,i),n.push(r)})}}return null}},{key:"print",value:function(){for(var e=this.width,t=this.height,n=this.start,i=this.win,r=this.blocks,o=[],s=function(t){for(var s=[],a=function(e){var o="_";i.x===e&&i.y===t&&(o="W"),n.x===e&&n.y===t&&(o="S"),r.forEach(function(n){n.x===e&&n.y===t&&(o="0")}),s.push(o)},l=0;l<e;l++)a(l);o.push(s)},a=0;a<t;a++)s(a);return o.map(function(e){return e.join("")}).join("\n")}}]),e}(),O=function e(t,n){Object(l.a)(this,e),this.level=void 0,this.soln=void 0,this.level=t,this.soln=n},x=function(){function e(t){Object(l.a)(this,e),this.level=void 0,this.soln=void 0,this.hero=void 0,this.level=t.level,this.soln=t.soln,this.hero=new k(this.level.start,[],[])}return Object(c.a)(e,[{key:"reset",value:function(){this.hero=new k(this.level.start,[],[])}},{key:"moveHero",value:function(e){var t=this.level,n=this.hero,i=t.applyMove(n.point,e);return n.addMove(i.point,e),i}}]),e}(),L=function(){function e(t,n){Object(l.a)(this,e),this.x=void 0,this.y=void 0,this.x=t,this.y=n}return Object(c.a)(e,[{key:"clone",value:function(){return new e(this.x,this.y)}},{key:"toString",value:function(){return"".concat(this.x,",").concat(this.y)}},{key:"equals",value:function(e){return this.toString()===e.toString()}}],[{key:"fromString",value:function(t){var n=t.split(",");return new e(parseFloat(n[0]),parseFloat(n[1]))}}]),e}();function M(e){for(var t=[],n=0;n<e;n++)t.push(n);return t}function E(e,t){return e+Math.random()*(t-e)}var P,T,S=function(){function e(t,n){Object(l.a)(this,e),this.spaces=[];for(var i=0;i<n;i++)for(var r=0;r<t;r++)this.spaces.push(new L(r,i))}return Object(c.a)(e,[{key:"pop",value:function(){var e=Math.floor(Math.random()*this.spaces.length);return this.spaces.splice(e,1)[0]}}]),e}(),A=function(){function e(t){Object(l.a)(this,e),this.settings=void 0,this.settings=t}return Object(c.a)(e,[{key:"tryGenerateLevel",value:function(e){var t=this.settings,n=t.width,i=t.height,r=t.minMovesOptions,o=new S(n,i),s=o.pop(),a=o.pop(),l=M(e).map(function(e){return o.pop()}),c=new j(n,i,a,s,l),u=c.solve();return u&&r.includes(u.moves.length)?new O(c,u):null}},{key:"generateLevels",value:function(e,t){for(var n=this.settings,i=n.width,r=n.height,o=n.blockPercentMin,s=n.blockPercentMax,a=[],l=0,c=Math.min(t/10,100);a.length<e&&l<t;)for(var u=i*r*E(o,s),h=0;a.length<e&&h<c;h++){l+=1;var v=this.tryGenerateLevel(u);v&&a.push(v)}return a}}]),e}(),R=function(){function e(t){Object(l.a)(this,e),this.started=void 0,this.milliseconds=void 0,this.started=new Date,this.milliseconds=t}return Object(c.a)(e,[{key:"getTime",value:function(){var e=(new Date).getTime()-this.started.getTime();return this.milliseconds-e}},{key:"getPercent",value:function(){return this.getTime()/this.milliseconds}},{key:"addTime",value:function(e){this.milliseconds+=e}}]),e}(),B=n(3);!function(e){e[e.Test=1]="Test",e[e.Easy=2]="Easy",e[e.Medium=3]="Medium",e[e.Hard=4]="Hard"}(T||(T={}));var W=(P={},Object(B.a)(P,T.Test,{dimensions:new L(10,8),minMoves:7,levelsPerTier:1,totalLevels:2,secondsPerLevel:10}),Object(B.a)(P,T.Easy,{dimensions:new L(10,8),minMoves:7,levelsPerTier:2,totalLevels:10,secondsPerLevel:10}),Object(B.a)(P,T.Medium,{dimensions:new L(15,12),minMoves:10,levelsPerTier:2,totalLevels:20,secondsPerLevel:7}),Object(B.a)(P,T.Hard,{dimensions:new L(20,16),minMoves:10,levelsPerTier:2,totalLevels:30,secondsPerLevel:7}),P),N=function(){function e(t){var n=this;Object(l.a)(this,e),this.difficulty=void 0,this.progression=void 0,this.levelsByMoves=void 0,this.loaded=!1,this.onLoad=void 0,this.registerLoaded=function(){},this.difficulty=t,this.progression=W[t],this.levelsByMoves=M(this.progression.totalLevels/this.progression.levelsPerTier).reduce(function(e,t){return e[t+n.progression.minMoves]=[],e},{}),this.onLoad=new Promise(function(e,t){n.registerLoaded=function(){return e(n)}})}return Object(c.a)(e,[{key:"getLevelKeys",value:function(){return Object.keys(this.levelsByMoves).map(parseFloat).sort(function(e,t){return e<t?-1:e>t?1:0})}},{key:"generateLevels",value:function(){var e=this.levelsByMoves,t=this.progression,n=t.dimensions,i=t.levelsPerTier,r=this.getLevelKeys().filter(function(t){return e[t].length<i});if(0===r.length)return this.loaded=!0,void this.registerLoaded();new A({width:n.x,height:n.y,blockPercentMin:.2,blockPercentMax:.3,minMovesOptions:r}).generateLevels(500,500).forEach(function(t){var n=e[t.soln.moves.length];n&&n.length<i&&n.push(t)})}},{key:"loadNow",value:function(){var e=Object(w.a)(m.a.mark(function e(){var t,n=this;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(;!this.loaded;)this.generateLevels();return t=this.getLevelKeys().reduce(function(e,t){return e.push.apply(e,Object(p.a)(n.levelsByMoves[t])),e},[]),e.abrupt("return",t);case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"displayName",value:function(){return T[this.difficulty]}}]),e}(),D=function(){function e(){Object(l.a)(this,e),this.loaders=void 0,this.loaders=[T.Test,T.Easy,T.Medium,T.Hard].map(function(e){return new N(e)})}return Object(c.a)(e,[{key:"loadInBackground",value:function(){var e=this.loaders.filter(function(e){return!e.loaded})[0];e&&(e.generateLevels(),e.loaded&&console.log("loaded:",T[e.difficulty]))}}]),e}(),I={ArrowLeft:i.Left,ArrowRight:i.Right,ArrowUp:i.Up,ArrowDown:i.Down};function H(e){var t=new Image,n={image:t,loaded:new Promise(function(e,n){t.onload=function(){return e(!0)}})};return t.src=e,n}var K=function(){function e(t,n){var i=this;Object(l.a)(this,e),this.canvasElm=void 0,this.ctx=void 0,this.currentLevel=void 0,this.currentLevelIndex=0,this.sprites=void 0,this.loadedAssets=void 0,this.pendingAnimations=[],this.world=void 0,this.canvasElm=t,t.width=document.body.clientHeight,t.height=.8*document.body.clientHeight,this.ctx=t.getContext("2d"),this.sprites={hero:H("img/ice_blue.png")};var r=Object.values(this.sprites);this.loadedAssets=Promise.all(r.map(function(e){return e.loaded})).then(function(){return!0}),window.addEventListener("keydown",function(e){var t=I[e.code]||void 0;t&&i.handleMove(t),"KeyR"===e.code&&(i.currentLevel&&i.currentLevel.reset(),i.draw()),"KeyN"===e.code&&i.nextLevel()}),this.world=n,this.nextLevel(),this.loop()}return Object(c.a)(e,[{key:"loop",value:function(){var e=Object(w.a)(m.a.mark(function e(){var t=this;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.draw();case 2:window.requestAnimationFrame(function(){return t.loop()});case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"handleMove",value:function(e){var t=this.currentLevel;if(t){var n=t.moveHero(e);this.animateMove(n),t.level.isWinningPoint(n.point)&&this.nextLevel()}}},{key:"nextLevel",value:function(){var e=Object(w.a)(m.a.mark(function e(){var t,n,i,r;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.currentLevelIndex,n=this.world){e.next=3;break}throw new Error("todo this should be impossible");case 3:return this.pendingAnimations=[],e.next=6,n.loadNow();case 6:i=e.sent,r=i[t],this.currentLevel=r&&new x(r),r&&(console.log(this.currentLevel.soln.printMoves()),this.currentLevelIndex+=1);case 10:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"animateMove",value:function(e){var t,n=e.traveled.map(function(e,t,n){return{point:e,stopwatch:new R(1e3*(1+t/n.length))}});(t=this.pendingAnimations).push.apply(t,Object(p.a)(n))}},{key:"draw",value:function(){var e=Object(w.a)(m.a.mark(function e(){var t,n,i,r,o,s,a,l,c,u,h;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.canvasElm,n=this.ctx,i=this.currentLevel,r=this.loadedAssets,o=this.sprites,s=t.width,a=t.height,e.next=4,r;case 4:if(n.fillStyle="black",n.fillRect(0,0,s,a),i){e.next=11;break}return n.font="20px monospace",n.fillStyle="white",n.fillText("you win! refresh the page to start over",100,100),e.abrupt("return");case 11:for(l=s/i.level.width,c=a/i.level.height,n.strokeStyle="white",u=1;u<i.level.height;u++)n.beginPath(),n.moveTo(0,u*c),n.lineTo(s,u*c),n.stroke();for(h=1;h<i.level.width;h++)n.beginPath(),n.moveTo(h*l,0),n.lineTo(h*l,a),n.stroke();n.fillStyle="grey",n.fillRect(i.level.start.x*l,i.level.start.y*c,l,c),n.fillStyle="lightgreen",n.fillRect(i.level.win.x*l,i.level.win.y*c,l,c),n.fillStyle="lightgrey",i.level.blocks.forEach(function(e){n.fillRect(e.x*l,e.y*c,l,c)}),this.pendingAnimations=this.pendingAnimations.filter(function(e){return e.stopwatch.getTime()>0}),this.pendingAnimations.forEach(function(e){var t=e.point,i=e.stopwatch.getPercent();n.fillStyle="rgba(150, 150, 255, ".concat(i,")"),n.fillRect(t.x*l+.2*l,t.y*c+.2*c,.6*l,.6*c)}),n.drawImage(o.hero.image,i.hero.point.x*l+.2*l,i.hero.point.y*c+.2*c,.6*l,.6*c);case 25:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),e}();function C(){var e=Object(d.a)(["\n  margin: 2rem;\n\n  width: 100vh;\n  height: 80vh;\n"]);return C=function(){return e},e}function F(){var e=Object(d.a)(["\n  display: flex;\n  flex-direction: column;\n  justify-content: flex-start;\n  align-items: center;\n  flex-wrap: nowrap;\n"]);return F=function(){return e},e}var U=f.a.div(F()),q=f.a.canvas(C()),G=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(u.a)(this,Object(h.a)(t).call(this,e))).canvasRef=void 0,n.manager=void 0,n.canvasRef=o.a.createRef(),n}return Object(v.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this.canvasRef.current;e&&(this.manager=new K(e,this.props.world))}},{key:"render",value:function(){var e=this.props.world;return o.a.createElement(U,null,o.a.createElement("p",null,"use arrow keys to move. press R to restart the level",o.a.createElement("br",null),e.displayName()," has ",e.progression.totalLevels," levels, and they get harder as you go. try to beat them all!"),o.a.createElement(q,{ref:this.canvasRef}))}}]),t}(o.a.Component);function z(){var e=Object(d.a)(["\n  cursor: pointer;\n  border: 2px solid white;\n\n  &:hover {\n    color: black;\n    background-color: white;\n  }\n"]);return z=function(){return e},e}function J(){var e=Object(d.a)(["\n  padding: 1em;\n  width: 5em;\n\n  border: 2px solid grey;\n  border-radius: 0.5em;\n"]);return J=function(){return e},e}function _(){var e=Object(d.a)(["\n  margin: 2em;\n\n  display: flex;\n  flex-direction: column;\n  justify-content: flex-start;\n  align-items: center;\n  flex-wrap: nowrap;\n"]);return _=function(){return e},e}function Y(){var e=Object(d.a)(["\n  display: flex;\n  flex-direction: row;\n  justify-content: center;\n  align-items: center;\n  flex-wrap: nowrap;\n"]);return Y=function(){return e},e}var Q=f.a.div(Y()),V=f.a.div(_()),X=f.a.div(J()),Z=Object(f.a)(X)(z()),$=function(e){function t(){var e,n,i;Object(l.a)(this,t);for(var r=arguments.length,o=new Array(r),s=0;s<r;s++)o[s]=arguments[s];return(i=Object(u.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(o)))).state=(n={},Object(B.a)(n,T.Test,!1),Object(B.a)(n,T.Easy,!1),Object(B.a)(n,T.Medium,!1),Object(B.a)(n,T.Hard,!1),n),i}return Object(v.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.props.worldLoader.loaders.forEach(function(t){t.onLoad.then(function(){e.setState(Object(B.a)({},t.difficulty,!0))})})}},{key:"loadWorld",value:function(e){e.loaded&&this.props.loadWorld(e)}},{key:"render",value:function(){var e=this,t=this.props.worldLoader,n=this.state;return o.a.createElement("div",null,o.a.createElement("h1",null,"ice slide puzzle game"),o.a.createElement("p",null,"select your difficulty level"),o.a.createElement(Q,null,t.loaders.map(function(t){return o.a.createElement(V,{key:t.difficulty},o.a.createElement("h2",null,t.displayName()),o.a.createElement("div",null,t.progression.totalLevels," levels"),o.a.createElement("h3",null,n[t.difficulty]?o.a.createElement(Z,{onClick:function(){return e.loadWorld(t)}},"PLAY"):o.a.createElement(X,null,"loading")))})))}}]),t}(o.a.Component);function ee(){var e=Object(d.a)(["\n  text-align: center;\n\n  display: flex;\n  flex-direction: column;\n  justify-content: flex-start;\n  align-items: center;\n  flex-wrap: nowrap;\n"]);return ee=function(){return e},e}var te=f.a.div(ee()),ne=function(e){function t(){var e,n;Object(l.a)(this,t);for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return(n=Object(u.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(r)))).worldLoader=new D,n.state={world:void 0},n}return Object(v.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.loop()}},{key:"loop",value:function(){var e=this;this.state.world||(this.worldLoader.loadInBackground(),window.requestAnimationFrame(function(){return e.loop()}))}},{key:"loadWorld",value:function(e){this.setState({world:e})}},{key:"render",value:function(){var e=this,t=this.worldLoader,n=this.state.world;return o.a.createElement(te,null,n?o.a.createElement(G,{world:n}):o.a.createElement($,{worldLoader:t,loadWorld:function(t){return e.loadWorld(t)}}))}}]),t}(o.a.Component);n(33);var ie={testLevelGen:function(){var e=new j(5,5,new L(1,1),new L(3,3),[new L(2,4)]);console.log(e.print()),console.log(e.solve());var t=new j(5,5,new L(1,1),new L(3,3),[new L(4,0)]);console.log(t.print()),console.log(t.solve()),new A(5,5,.1,5).generateLevels(10,1e3).forEach(function(e){console.log(e.level.print()),console.log("Solution:",e.soln.printMoves()),console.log("\n")})}};window.scripts=ie,a.a.render(o.a.createElement(ne,null),document.getElementById("root"))}},[[21,1,2]]]);
//# sourceMappingURL=main.5e781e18.chunk.js.map