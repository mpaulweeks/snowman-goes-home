(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{30:function(e,t,n){e.exports=n(42)},41:function(e,t,n){},42:function(e,t,n){"use strict";n.r(t);var i=n(0),r=n.n(i),o=n(17),a=n.n(o),s=n(10),l=n(1),c=n(2),u=n(8),h=n(7),v=n(9),d=n(3),f=n(4);function p(){var e=Object(d.a)(["\n  height: 4vh;\n  width: auto;\n  min-width: 2em;\n  padding: 0 0.75em;\n  margin: 0 0.3em;\n"]);return p=function(){return e},e}function m(){var e=Object(d.a)(["\n  cursor: pointer;\n\n  border-color: var(--foreground);\n  font-style: normal;\n  color: var(--foreground);\n\n  &:hover {\n    color: var(--background);\n    background-color: var(--foreground);\n  }\n"]);return m=function(){return e},e}function g(){var e=Object(d.a)(["\n  width: 4em;\n  padding: 0.5em;\n  border-radius: 1em;\n\n  border: 2px solid grey;\n  font-style: italic;\n  color: grey;\n\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n  flex-wrap: nowrap;\n\n"]);return g=function(){return e},e}function y(){var e=Object(d.a)(["\n  flex-direction: column;\n"]);return y=function(){return e},e}function b(){var e=Object(d.a)(["\n  display: flex;\n  flex-direction: row;\n  justify-content: space-around;\n  align-items: stretch;\n  flex-wrap: nowrap;\n"]);return b=function(){return e},e}function w(){var e=Object(d.a)(["\n  position: absolute;\n  top: 0px;\n  left: 0px;\n  z-index: 1;\n  width: 100%;\n  height: 100vh;\n\n  background-color: var(--background);\n"]);return w=function(){return e},e}var k=f.a.div(w()),O=f.a.div(b()),j=Object(f.a)(O)(y()),x=f.a.div(g()),E=Object(f.a)(x)(m()),L=Object(f.a)(E)(p());function M(){var e=Object(d.a)(["\n  position: absolute;\n  top: 0px;\n  left: 0px;\n  width: 100%;\n  height: 100%;\n  background-image: url('img/snow_loose.gif');\n  background-size: contain;\n  background-repeat: none;\n"]);return M=function(){return e},e}function R(){var e=Object(d.a)(["\n  position: relative;\n"]);return R=function(){return e},e}function S(){var e=Object(d.a)(["\n  font-family: monospace;\n  font-size: 1.2em;\n  font-weight: bold;\n"]);return S=function(){return e},e}function I(){var e=Object(d.a)(["\n  height: 10vh;\n"]);return I=function(){return e},e}function P(){var e=Object(d.a)(["\n  height: 20vh;\n"]);return P=function(){return e},e}function D(){var e=Object(d.a)(["\n  justify-content: flex-start;\n  align-items: center;\n  width: 5em;\n  margin-top: 1em;\n"]);return D=function(){return e},e}function T(){var e=Object(d.a)(["\n  width: 100%;\n  margin: 0px;\n"]);return T=function(){return e},e}function G(){var e=Object(d.a)(["\n  display: flex;\n  flex-direction: column;\n  justify-content: flex-start;\n  align-items: center;\n  flex-wrap: nowrap;\n"]);return G=function(){return e},e}var A,B=f.a.div(G()),C=Object(f.a)(O)(T()),W=Object(f.a)(j)(D()),z=Object(f.a)(C)(P()),H=Object(f.a)(C)(I()),K=f.a.div(S()),N=f.a.div(R()),U=f.a.div(M()),_=function(e){function t(){return Object(l.a)(this,t),Object(u.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(v.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this.props.gm,t=this.props.store,n=t.world,i=t.level,o=t.secondsRemaining,a=t.secondsElapsed;return r.a.createElement(B,null,r.a.createElement(z,null,r.a.createElement(W,null,r.a.createElement("div",null,"Level ",i+1)),r.a.createElement(j,null,r.a.createElement(O,null,r.a.createElement(L,{onClick:e.clickUp},"up")),r.a.createElement(O,null,r.a.createElement(L,{onClick:e.clickLeft},"left"),r.a.createElement(L,{onClick:e.clickRight},"right")),r.a.createElement(O,null,r.a.createElement(L,{onClick:e.clickDown},"down"))),r.a.createElement(W,null,r.a.createElement(K,null,n&&n.isInfinite()?o:a,"s"))),r.a.createElement(N,null,this.props.children,r.a.createElement(U,null)),r.a.createElement(H,null,r.a.createElement(j,null,r.a.createElement(L,{onClick:e.clickReset},"reset")),r.a.createElement(j,null,r.a.createElement(L,{onClick:e.clickToggleGrid},"toggle grid"))))}}]),t}(r.a.Component),F=Object(s.b)(function(e){return{store:e}})(_),q=n(14),J=n(5),V=n(12);!function(e){e[e.Up=1]="Up",e[e.Down=2]="Down",e[e.Left=3]="Left",e[e.Right=4]="Right"}(A||(A={}));var Y,Q=Object.keys(A).filter(function(e){return isNaN(Number(e))}).map(function(e){return A[e]}),X=function(){function e(t,n,i){Object(l.a)(this,e),this.point=void 0,this.points=void 0,this.moves=void 0,this.point=t,this.points=n,this.moves=i}return Object(c.a)(e,[{key:"addMove",value:function(e,t){this.points.push(this.point),this.moves.push(t),this.point=e}},{key:"getNextMoves",value:function(){var e=this;return Q.map(function(t){return{move:t,history:e.clone()}})}},{key:"clone",value:function(){return new e(this.point,Object(V.a)(this.points),Object(V.a)(this.moves))}},{key:"printMoves",value:function(){return this.moves.map(function(e){return A[e]}).join(", ")}}]),e}();!function(e){e[e.Start=1]="Start",e[e.Win=2]="Win",e[e.Block=3]="Block"}(Y||(Y={}));var Z=function(){function e(t,n,i,r,o){Object(l.a)(this,e),this.width=void 0,this.height=void 0,this.start=void 0,this.win=void 0,this.blocks=void 0,this.blocksByKey={},this.width=t,this.height=n,this.start=i,this.win=r,this.blocks=o,this.blocksByKey=this.blocks.reduce(function(e,t){return e[t.toString()]=Y.Block,e},{})}return Object(c.a)(e,[{key:"isWinningPoint",value:function(e){return this.win.equals(e)}},{key:"isIllegalPoint",value:function(e){var t=this.blocksByKey,n=this.width,i=this.height;return!!t[e.toString()]||e.x<0||e.x>=n||e.y<0||e.y>=i}},{key:"applyMove",value:function(e,t){for(var n=e,i=[n];;){var r=n.clone();if(t===A.Left)r.x--;else if(t===A.Right)r.x++;else if(t===A.Up)r.y--;else{if(t!==A.Down)throw new Error("unexpected move: ".concat(t));r.y++}if(this.isIllegalPoint(r))break;if(i.push(r),n=r,this.isWinningPoint(n))break}return{point:n,traveled:i}}},{key:"solve",value:function(){for(var e=this,t={},n=[new X(this.start,[],[])];n.length;){var i=n.shift(),r=i.point.toString();if(!t[r]){if(t[r]=!0,this.isWinningPoint(i.point))return i;i.getNextMoves().forEach(function(t){var i=t.move,r=t.history,o=e.applyMove(r.point,i).point;r.addMove(o,i),n.push(r)})}}return null}},{key:"print",value:function(){for(var e=this.width,t=this.height,n=this.start,i=this.win,r=this.blocks,o=[],a=function(t){for(var a=[],s=function(e){var o="_";i.x===e&&i.y===t&&(o="W"),n.x===e&&n.y===t&&(o="S"),r.forEach(function(n){n.x===e&&n.y===t&&(o="0")}),a.push(o)},l=0;l<e;l++)s(l);o.push(a)},s=0;s<t;s++)a(s);return o.map(function(e){return e.join("")}).join("\n")}}]),e}(),$=function e(t,n){Object(l.a)(this,e),this.level=void 0,this.soln=void 0,this.level=t,this.soln=n},ee=function(){function e(t){Object(l.a)(this,e),this.level=void 0,this.soln=void 0,this.hero=void 0,this.level=t.level,this.soln=t.soln,this.hero=new X(this.level.start,[],[])}return Object(c.a)(e,[{key:"reset",value:function(){this.hero=new X(this.level.start,[],[])}},{key:"moveHero",value:function(e){var t=this.level,n=this.hero,i=t.applyMove(n.point,e);return n.addMove(i.point,e),i}}]),e}(),te=function(){function e(t,n){Object(l.a)(this,e),this.x=void 0,this.y=void 0,this.x=t,this.y=n}return Object(c.a)(e,[{key:"clone",value:function(){return new e(this.x,this.y)}},{key:"toString",value:function(){return"".concat(this.x,",").concat(this.y)}},{key:"equals",value:function(e){return this.toString()===e.toString()}}],[{key:"fromString",value:function(t){var n=t.split(",");return new e(parseFloat(n[0]),parseFloat(n[1]))}}]),e}();function ne(e){for(var t=[],n=0;n<e;n++)t.push(n);return t}function ie(e,t){return e+Math.random()*(t-e)}var re,oe,ae=function(){function e(t,n){Object(l.a)(this,e),this.spaces=[];for(var i=0;i<n;i++)for(var r=0;r<t;r++)this.spaces.push(new te(r,i))}return Object(c.a)(e,[{key:"pop",value:function(){var e=Math.floor(Math.random()*this.spaces.length);return this.spaces.splice(e,1)[0]}}]),e}(),se=function(){function e(t){Object(l.a)(this,e),this.settings=void 0,this.settings=t}return Object(c.a)(e,[{key:"tryGenerateLevel",value:function(e){var t=this.settings,n=t.width,i=t.height,r=t.minMovesOptions,o=new ae(n,i),a=o.pop(),s=o.pop(),l=ne(e).map(function(e){return o.pop()}),c=new Z(n,i,s,a,l),u=c.solve();return u&&r.includes(u.moves.length)?new $(c,u):null}},{key:"generateLevels",value:function(e,t){for(var n=this.settings,i=n.width,r=n.height,o=n.blockPercentMin,a=n.blockPercentMax,s=[],l=0,c=Math.min(t/10,100);s.length<e&&l<t;)for(var u=i*r*ie(o,a),h=0;s.length<e&&h<c;h++){l+=1;var v=this.tryGenerateLevel(u);v&&s.push(v)}return s}}]),e}(),le=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;Object(l.a)(this,e),this.started=void 0,this.milliseconds=void 0,this.started=new Date,this.milliseconds=t}return Object(c.a)(e,[{key:"getElapsed",value:function(){return(new Date).getTime()-this.started.getTime()}},{key:"getRemaining",value:function(){return this.milliseconds-this.getElapsed()}},{key:"getPercent",value:function(){return this.getRemaining()/this.milliseconds}},{key:"addTime",value:function(e){this.milliseconds+=e}},{key:"formatElapsed",value:function(){return Math.floor(this.getElapsed()/1e3).toString(10)}},{key:"formatRemaining",value:function(){return Math.floor(this.getRemaining()/1e3).toString(10)}}]),e}(),ce=n(6),ue=n.n(ce),he=n(15);!function(e){e[e.Easy=1]="Easy",e[e.Medium=2]="Medium",e[e.Hard=3]="Hard",e[e.Infinite=4]="Infinite"}(oe||(oe={}));var ve,de=(re={},Object(J.a)(re,oe.Easy,{gridSize:1,minMoves:7,levelsPerTier:2,totalLevels:10}),Object(J.a)(re,oe.Medium,{gridSize:1.5,minMoves:7,levelsPerTier:1,totalLevels:15}),Object(J.a)(re,oe.Hard,{gridSize:2,minMoves:10,levelsPerTier:2,totalLevels:20}),Object(J.a)(re,oe.Infinite,{gridSize:1.5,minMoves:7,levelsPerTier:3,totalLevels:20,secondsPerLevel:5}),re),fe=function(){function e(t,n){var i=this;Object(l.a)(this,e),this.dimensions=void 0,this.difficulty=void 0,this.totalLevels=void 0,this.progression=void 0,this.loaded=!1,this.onLoad=void 0,this.registerLoaded=function(){},this.dimensions=t,this.difficulty=n,this.progression=de[n],this.onLoad=new Promise(function(e,t){i.registerLoaded=function(){return e(i)}}),this.totalLevels=this.progression.totalLevels}return Object(c.a)(e,[{key:"displayName",value:function(){return oe[this.difficulty]}},{key:"isInfinite",value:function(){return this.difficulty===oe.Infinite}},{key:"createStopwatch",value:function(){var e=1e3*(60-(this.progression.secondsPerLevel||0));return new le(this.isInfinite()?e:void 0)}},{key:"generateLevels",value:function(){throw new Error("base class")}},{key:"loadLevel",value:function(e){throw new Error("base class")}}]),e}(),pe=function(e){function t(e,n){var i;return Object(l.a)(this,t),(i=Object(u.a)(this,Object(h.a)(t).call(this,e,n))).levelsByMoves=void 0,i.levelsByMoves=ne(i.progression.totalLevels/i.progression.levelsPerTier).reduce(function(e,t){return e[t+i.progression.minMoves]=[],e},{}),i}return Object(v.a)(t,e),Object(c.a)(t,[{key:"getLevelKeys",value:function(){return Object.keys(this.levelsByMoves).map(parseFloat).sort(function(e,t){return e<t?-1:e>t?1:0})}},{key:"generateLevels",value:function(){var e=this.dimensions,t=this.levelsByMoves,n=this.progression,i=n.gridSize,r=n.levelsPerTier,o=this.getLevelKeys().filter(function(e){return t[e].length<r});if(0===o.length)return this.loaded=!0,void this.registerLoaded();var a=new te(e.x*i,e.y*i);new se({width:a.x,height:a.y,blockPercentMin:.05,blockPercentMax:.3,minMovesOptions:o}).generateLevels(500,500).forEach(function(e){var n=t[e.soln.moves.length];n&&n.length<r&&n.push(e)})}},{key:"loadLevel",value:function(){var e=Object(he.a)(ue.a.mark(function e(t){var n,i=this;return ue.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(;!this.loaded;)this.generateLevels();return n=this.getLevelKeys().reduce(function(e,t){return e.push.apply(e,Object(V.a)(i.levelsByMoves[t])),e},[]),e.abrupt("return",n[t]);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),t}(fe),me=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(u.a)(this,Object(h.a)(t).call(this,e,oe.Infinite))).levels=[],n.lastIndex=0,n}return Object(v.a)(t,e),Object(c.a)(t,[{key:"generateLevels",value:function(){var e,t=this.dimensions,n=this.levels,i=this.progression,r=this.lastIndex,o=i.gridSize;if(n.length>r+10)return this.loaded=!0,void this.registerLoaded();var a,s,l=new te(t.x*o,t.y*o),c=new se({width:l.x,height:l.y,blockPercentMin:.05,blockPercentMax:.3,minMovesOptions:(a=i.minMoves,s=10,ne(s).map(function(e){return e+a}))});(e=this.levels).push.apply(e,Object(V.a)(c.generateLevels(10,10))),n.length>r+10&&console.log("infinite loaded!")}},{key:"loadLevel",value:function(){var e=Object(he.a)(ue.a.mark(function e(t){return ue.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(;t>this.levels.length;)this.generateLevels();return this.lastIndex=t,e.abrupt("return",this.levels[t]);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),t}(fe),ge=function(){function e(t){Object(l.a)(this,e),this.loaders=void 0,this.loaders=[new me(t)].concat(Object(V.a)([oe.Easy,oe.Medium,oe.Hard].map(function(e){return new pe(t,e)})))}return Object(c.a)(e,[{key:"getLoaderByDifficulty",value:function(e){return this.loaders.filter(function(t){return t.difficulty===e})[0]}},{key:"loadInBackground",value:function(){var e=this.loaders.filter(function(e){return!e.loaded})[0];e&&(e.generateLevels(),e.loaded&&console.log("loaded:",oe[e.difficulty]))}}]),e}();function ye(){var e=Object(d.a)(["\n  margin-bottom: 0.5rem;\n"]);return ye=function(){return e},e}function be(){var e=Object(d.a)(["\n  margin: 1em;\n\n  display: flex;\n  flex-direction: column;\n  justify-content: flex-start;\n  align-items: center;\n  flex-wrap: nowrap;\n"]);return be=function(){return e},e}function we(){var e=Object(d.a)(["\n  display: flex;\n  flex-direction: row;\n  justify-content: center;\n  align-items: center;\n  flex-wrap: wrap;\n"]);return we=function(){return e},e}var ke=f.a.div(we()),Oe=f.a.div(be()),je=f.a.h2(ye()),xe=(ve={},Object(J.a)(ve,oe.Easy,!1),Object(J.a)(ve,oe.Medium,!1),Object(J.a)(ve,oe.Hard,!1),Object(J.a)(ve,oe.Infinite,!1),ve),Ee=function(e){function t(){var e,n;Object(l.a)(this,t);for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return(n=Object(u.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(r)))).state=Object(q.a)({},xe),n}return Object(v.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.reset()}},{key:"reset",value:function(){var e=this;this.setState(Object(q.a)({},xe),function(){e.props.gm.worldLoader.loaders.forEach(function(t){t.onLoad.then(function(){e.setState(Object(J.a)({},t.difficulty,!0))})})})}},{key:"loadWorld",value:function(e){e.loaded&&(this.props.gm.setWorld(e),this.reset())}},{key:"render",value:function(){var e=this,t=this.props.store,n=this.state,i=this.props.gm.worldLoader;if(t.world)return"";var o=[oe.Easy,oe.Medium,oe.Hard,oe.Infinite];return r.a.createElement(k,null,r.a.createElement("h1",null,"ice slide puzzle game"),r.a.createElement("p",null,"select your difficulty level"),r.a.createElement(ke,null,o.map(function(e){return i.getLoaderByDifficulty(e)}).map(function(t){return r.a.createElement(Oe,{key:t.difficulty},r.a.createElement(je,null,t.displayName()),r.a.createElement("div",null,t.isInfinite()?"\u221e":t.totalLevels," levels"),r.a.createElement("h3",null,n[t.difficulty]?r.a.createElement(E,{onClick:function(){return e.loadWorld(t)}},"PLAY"):r.a.createElement(x,null,"loading")))})),r.a.createElement("p",null,"made by ",r.a.createElement("a",{href:"https://twitter.com/mpaulweeks"},"@mpaulweeks")))}}]),t}(r.a.Component),Le=Object(s.b)(function(e){return{store:e}})(Ee),Me=function(e){function t(){var e,n;Object(l.a)(this,t);for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return(n=Object(u.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(r)))).onReset=function(){n.props.gm.unsetWorld()},n}return Object(v.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this.props,t=e.gm,n=e.store,i=n.world,o=n.isGameOver;return i&&o?r.a.createElement(k,null,r.a.createElement(O,null,r.a.createElement("h1",null,i.isInfinite()?"\n              game over! you managed to complete ".concat(t.currentLevelIndex-1," levels\n            "):"\n              you win! your score is ".concat(n.secondsElapsed,". try to get it lower!\n            "))),r.a.createElement(O,null,r.a.createElement(E,{onClick:this.onReset},"RESET"))):""}}]),t}(r.a.Component),Re=Object(s.b)(function(e){return{store:e}})(Me),Se=n(18),Ie="SET_GAME_OVER",Pe="SET_LEVEL",De="SET_TIMER",Te="SET_WORLD",Ge={secondsRemaining:0,secondsElapsed:0,level:0,world:void 0,isGameOver:!1};var Ae=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ge,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Ie:return Object(q.a)({},e,{isGameOver:!0});case Pe:var n=t.payload.level;return Object(q.a)({},e,{level:n});case De:var i=t.payload.stopwatch;return Object(q.a)({},e,{secondsElapsed:i&&i.formatElapsed(),secondsRemaining:i&&i.formatRemaining()});case Te:var r=t.payload.world;return Object(q.a)({},e,{isGameOver:!1,world:r});default:return e}},Be=Object(Se.b)(Ae),Ce=function(e){return{type:De,payload:{stopwatch:e}}},We=function(e){return{type:Te,payload:{world:e}}},ze="black",He="yellow",Ke="black",Ne="rgba(150, 150, 255, 1)",Ue={hero:"ice_blue.png"},_e={ArrowLeft:A.Left,ArrowRight:A.Right,ArrowUp:A.Up,ArrowDown:A.Down};function Fe(e){var t=new Image,n={image:t,loaded:new Promise(function(e,n){t.onload=function(){return e(!0)}})};return t.src=e,n}var qe=function(){function e(){var t=this;Object(l.a)(this,e),this.dispatch=Be.dispatch,this.worldLoader=void 0,this.worldDimensions=void 0,this.canvasDimensions=void 0,this.canvasElm=void 0,this.ctx=void 0,this.world=void 0,this.stopwatch=new le,this.currentLevel=void 0,this.currentLevelIndex=0,this.sprites=void 0,this.loadedAssets=void 0,this.pendingAnimations=[],this.shouldDrawGrid=!1,this.clickReset=function(){t.currentLevel&&t.currentLevel.reset()},this.clickToggleGrid=function(){t.shouldDrawGrid=!t.shouldDrawGrid},this.clickUp=function(){t.handleMove(A.Up)},this.clickDown=function(){t.handleMove(A.Down)},this.clickLeft=function(){t.handleMove(A.Left)},this.clickRight=function(){t.handleMove(A.Right)};for(var n=document.body.clientHeight,i=document.body.clientWidth,r=n>i?new te(8,10):new te(10,8),o=.7*document.body.clientHeight,a=o*r.x/r.y;a>i;)r.x-=1,a=o*r.x/r.y;this.worldDimensions=r,this.worldLoader=new ge(this.worldDimensions),this.canvasDimensions=new te(a,o),this.sprites={hero:Fe("img/"+Ue.hero)};var s=Object.values(this.sprites);this.loadedAssets=Promise.all(s.map(function(e){return e.loaded})).then(function(){return!0}),window.addEventListener("keydown",function(e){var n=_e[e.code]||void 0;n&&t.handleMove(n),"KeyR"===e.code&&t.clickReset(),"KeyN"===e.code&&t.nextLevel()}),this.loop()}return Object(c.a)(e,[{key:"loop",value:function(){var e=Object(he.a)(ue.a.mark(function e(){var t,n,i=this;return ue.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.world,n=this.stopwatch,!t){e.next=7;break}return e.next=4,this.draw();case 4:t.isInfinite()?(t.generateLevels(),n.getRemaining()!==Be.getState().secondsRemaining&&this.dispatch(Ce(n)),n.getRemaining()<0&&this.triggerGameOver()):n.getElapsed()!==Be.getState().secondsElapsed&&this.dispatch(Ce(n)),e.next=8;break;case 7:Be.getState().isGameOver||this.worldLoader.loadInBackground();case 8:window.requestAnimationFrame(function(){return i.loop()});case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"setup",value:function(e){this.canvasElm=e,e.width=this.canvasDimensions.x,e.height=this.canvasDimensions.y,this.ctx=e.getContext("2d")}},{key:"setWorld",value:function(e){this.worldLoader=new ge(this.worldDimensions),this.world=e,this.currentLevelIndex=0,this.stopwatch=e.createStopwatch(),this.nextLevel(),this.dispatch(We(e))}},{key:"unsetWorld",value:function(){this.world=void 0,this.dispatch(We(void 0))}},{key:"triggerGameOver",value:function(){this.world=void 0,this.dispatch({type:Ie,payload:{}})}},{key:"handleMove",value:function(e){var t=this.currentLevel;if(t){var n=t.moveHero(e);this.animateMove(n),t.level.isWinningPoint(n.point)&&this.nextLevel()}}},{key:"nextLevel",value:function(){var e=Object(he.a)(ue.a.mark(function e(){var t,n,i;return ue.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.currentLevelIndex,n=this.world){e.next=3;break}throw new Error("todo this should be impossible");case 3:return e.next=5,n.loadLevel(t);case 5:i=e.sent,this.currentLevel=i&&new ee(i),this.currentLevel?(console.log(this.currentLevel.soln.printMoves()),this.dispatch((r=this.currentLevelIndex,{type:Pe,payload:{level:r}})),this.currentLevelIndex+=1,this.stopwatch.addTime(1e3*(n.progression.secondsPerLevel||0))):this.triggerGameOver();case 8:case"end":return e.stop()}var r},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"animateMove",value:function(e){var t,n=e.traveled.map(function(e,t,n){return{point:e,stopwatch:new le(1e3*(1+t/n.length))}});(t=this.pendingAnimations).push.apply(t,Object(V.a)(n))}},{key:"draw",value:function(){var e=Object(he.a)(ue.a.mark(function e(){var t,n,i,r,o,a,s,l,c,u,h,v;return ue.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.canvasElm,n=this.ctx,i=this.currentLevel,r=this.loadedAssets,o=this.sprites,t&&n){e.next=3;break}return e.abrupt("return");case 3:return a=t.width,s=t.height,e.next=6,r;case 6:if((l=n.createLinearGradient(0,0,a,s)).addColorStop(0,"#eeeeee"),l.addColorStop(1,"#bbbbbb"),n.fillStyle=l,n.fillRect(0,0,a,s),i){e.next=16;break}return n.font="20px monospace",n.fillStyle=Ke,n.fillText("you win! returning to the main menu...",100,100),e.abrupt("return");case 16:if(c=a/i.level.width,u=s/i.level.height,this.shouldDrawGrid){for(n.strokeStyle=Ke,h=1;h<i.level.height;h++)n.beginPath(),n.moveTo(0,h*u),n.lineTo(a,h*u),n.stroke();for(v=1;v<i.level.width;v++)n.beginPath(),n.moveTo(v*c,0),n.lineTo(v*c,s),n.stroke()}n.fillStyle=He,n.fillRect(i.level.win.x*c,i.level.win.y*u,c,u),n.fillStyle=ze,i.level.blocks.forEach(function(e){n.fillRect(e.x*c,e.y*u,c,u)}),this.pendingAnimations=this.pendingAnimations.filter(function(e){return e.stopwatch.getRemaining()>0}),this.pendingAnimations.forEach(function(e){var t=e.point,i=e.stopwatch.getPercent();n.fillStyle="rgba(150, 150, 255, ".concat(i,")"),n.fillRect(t.x*c+.2*c,t.y*u+.2*u,.6*c,.6*u)}),n.strokeStyle=Ne,n.strokeRect(i.hero.point.x*c,i.hero.point.y*u,c,u),n.drawImage(o.hero.image,i.hero.point.x*c+.2*c,i.hero.point.y*u+.2*u,.6*c,.6*u);case 28:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),e}();function Je(){var e=Object(d.a)(["\n  height: 70vh;\n"]);return Je=function(){return e},e}function Ve(){var e=Object(d.a)(["\n  max-width: 50vh;\n  margin: 0px auto;\n  text-align: center;\n  display: flex;\n  flex-direction: column;\n  justify-content: flex-start;\n  align-items: center;\n  flex-wrap: nowrap;\n"]);return Ve=function(){return e},e}var Ye=f.a.div(Ve()),Qe=f.a.canvas(Je()),Xe=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(u.a)(this,Object(h.a)(t).call(this,e))).canvasRef=void 0,n.gm=new qe,n.canvasRef=r.a.createRef(),n}return Object(v.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this.canvasRef.current;e&&this.gm.setup(e)}},{key:"render",value:function(){var e=this.gm;return r.a.createElement(Ye,null,r.a.createElement(F,{gm:e},r.a.createElement(Qe,{ref:this.canvasRef})),r.a.createElement(Le,{gm:e}),r.a.createElement(Re,{gm:e}))}}]),t}(r.a.Component),Ze=Object(s.b)(function(e){return{store:e}})(Xe);n(41);var $e={testLevelGen:function(){var e=new Z(5,5,new te(1,1),new te(3,3),[new te(2,4)]);console.log(e.print()),console.log(e.solve());var t=new Z(5,5,new te(1,1),new te(3,3),[new te(4,0)]);console.log(t.print()),console.log(t.solve()),new se(5,5,.1,5).generateLevels(10,1e3).forEach(function(e){console.log(e.level.print()),console.log("Solution:",e.soln.printMoves()),console.log("\n")})}};window.scripts=$e,a.a.render(r.a.createElement(s.a,{store:Be},r.a.createElement(Ze,null)),document.getElementById("root"))}},[[30,1,2]]]);
//# sourceMappingURL=main.3aca025a.chunk.js.map